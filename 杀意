local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

local ATTACK_DISTANCE = 10
local triggeredNPCs = {}

RunService.RenderStepped:Connect(function()
    for _, npc in pairs(Workspace:WaitForChild("Enemies"):GetChildren()) do
        if npc:FindFirstChild("HumanoidRootPart") and not triggeredNPCs[npc] then
            local distance = (rootPart.Position - npc.HumanoidRootPart.Position).Magnitude
            if distance <= ATTACK_DISTANCE then
                triggeredNPCs[npc] = true
                local args = {
                    npc:WaitForChild("HumanoidRootPart"),
                    "Melee",
                    {
                        dismantle = false,
                        riposte = false,
                        backstab = true
                    }
                }
                ReplicatedStorage:WaitForChild("OnServerEvents"):WaitForChild("CombatServer"):FireServer(unpack(args))
            end
        end
    end
end)
